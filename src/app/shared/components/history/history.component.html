<mat-card appearance="outlined">
  <mat-card-content>
    <app-go-back></app-go-back>
    @if (error) {
      <div class="alert alert-danger">{{error}}</div>
    }
    <table>
      <tr>
        <th>Id</th>
        <th>User</th>
        <th>Date</th>
        <th>Action</th>
        <th>Field</th>
        <th>Note</th>
        <th>From</th>
        <th>To</th>
      </tr>
      @for (historyRecord of sortedData; track historyRecord) {
        @if (historyRecord.details && historyRecord.details.length > 0) {
          @for (change of historyRecord.details; track change; let isFirst = $first) {
            <tr>
              @if (isFirst) {
                <td [attr.rowspan]="historyRecord.details.length">
                  {{historyRecord.id}}
                </td>
              }
              @if (isFirst) {
                <td class="tablename" [attr.rowspan]="historyRecord.details.length">
                  {{historyRecord.user}}
                </td>
              }
              @if (isFirst) {
                <td class="nowrap-text-style" [attr.rowspan]="historyRecord.details.length">
                  {{historyRecord.date | date : 'medium'}}
                </td>
              }
              @if (isFirst) {
                <td class="tablename" [attr.rowspan]="historyRecord.details.length">
                  {{ historyRecord.comment }}
                </td>
              }
              <td> {{ change.field }}
              </td>
              <td> {{ change.note }}
              </td>
              <td>
                @if (isTextLargerThanLimit(change.oldValue)) {
                  <app-expandable-content [title]="getTitleForExpandable()" [content]="change.oldValue">
                  </app-expandable-content>
                } @else {
                  {{ change.oldValue || 'null'}}
                }
              </td>
              <td>
                @if (isTextLargerThanLimit(change.newValue)) {
                  <app-expandable-content [title]="getTitleForExpandable()" [content]="change.newValue">
                  </app-expandable-content>
                } @else {
                  {{ change.newValue || 'null'}}
                }
              </td>
            </tr>
          }
        } @else {
          <tr>
            <td>
              {{historyRecord.id}}
            </td>
            <td>
              {{historyRecord.user}}
            </td>
            <td class="nowrap-text-style">
              {{historyRecord.date | date : 'medium'}}
            </td>
            <td class="tablename">
              {{ historyRecord.comment }}
            </td>
          </tr>
        }
      }
    </table>
  </mat-card-content>
</mat-card>